# Workflows — Автоматизированные процессы Нейрона

Описание всех автоматизированных workflows бота.

---

## 📰 Новостной дайджест

### Расписание
| Время (UTC) | Дубай (UTC+4) | Алматы (UTC+6) | Тип |
|-------------|---------------|----------------|-----|
| 02:00 | 06:00 | 08:00 | Утренний дайджест |
| 09:00 | 13:00 | 15:00 | Дневной дайджест |
| 14:00 | 18:00 | 20:00 | Вечерний дайджест |

> Расписание адаптируется под текущий часовой пояс пользователя.

### Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│                    CRON TRIGGER (02:00/09:00/14:00 UTC)          │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  1. ДЕДУПЛИКАЦИЯ                                                │
│     - Прочитать data/sent-digests.json                          │
│     - Загрузить список отправленных за 7 дней                   │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. WEB SEARCH (Brave API)                                      │
│     - 7 категорий по приоритету                                 │
│     - Ключевые слова из news-config.md                          │
│     - Фильтр: пропустить URL/заголовки из sent-digests.json     │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. MULTI-ARMED BANDIT SELECTION                                │
│     - 70% проверенные источники (proven)                        │
│     - 30% новые источники (exploration)                         │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  4. DUAL RATING FILTER                                          │
│     - Рейтинг источников (proven/candidate/rejected)            │
│     - Рейтинг экспертов                                         │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  5. TELEGRAM DELIVERY                                           │
│     - Каждая новость = отдельное сообщение                      │
│     - Оценка через нативные реакции Telegram                    │
│     - 10-15 новостей за дайджест                                │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  6. ЗАПИСАТЬ ОТПРАВЛЕННЫЕ                                       │
│     - Сохранить заголовки/URL/keywords в sent-digests.json      │
│     - Удалить записи старше 7 дней                              │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  7. FEEDBACK LOOP                                               │
│     - Пользователь ставит emoji-реакцию (🔥👍👎💩)              │
│     - Система обновляет рейтинг источника                       │
│     - Следующий дайджест учитывает оценки                       │
└─────────────────────────────────────────────────────────────────┘
```

### Категории (по приоритету)
1. 🤖 **ИИ** — AI, ML, LLM, нейросети
2. 💻 **Вайбкодинг** — инструменты, лайфхаки разработки
3. 🦾 **Робототехника** — роботы, автоматизация
4. ✈️ **eVTOL** — электроавиация, дроны
5. ⚡ **Технологии** — общие технологии
6. 💼 **Бизнес** — стартапы, финансирование
7. 💰 **Инвестиции** — IPO, венчур

### Система оценок (нативные реакции Telegram)
| Реакция | Баллы | Эффект |
|---------|-------|--------|
| 🔥 Отлично | +10 | Источник становится приоритетным |
| 👍 Нравится | +5 | Источник получает бонус |
| 👎 Не нравится | -3 | Источник понижается |
| 💩 Мусор | -5 | Источник может быть исключён |

### Статусы источников
- **Proven** (7+ баллов) — используются в 70% случаев
- **Candidate** (-2 до 7) — используются в 30% (exploration)
- **Rejected** (<-2) — исключены из дайджестов

### Команда `/digest`
Внеочередной дайджест по требованию:
```
/digest
```

### Файлы системы
| Файл | Назначение |
|------|------------|
| `digest-format-final.md` | Формат сообщений + правила дедупликации |
| `news-config.md` | Ключевые слова и категории |
| `dual-rating-system.js` | Система рейтинга |
| `multi-armed-bandit.js` | Алгоритм выбора |
| `data/source-ratings.json` | Рейтинги источников |
| `data/user-feedback.json` | История оценок |
| `data/sent-digests.json` | Трекинг отправленных (дедупликация) |

---

## 🧠 Система рефлексий

### Расписание
| Время | Тип | Описание |
|-------|-----|----------|
| 20:30 ежедневно | Двойная рефлексия | Моя + с пользователем |
| 20:30 воскресенье | Еженедельный отчёт | Аналитика недели |
| 06:00 ежедневно | План действий | Из вчерашней рефлексии |

### Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│                    CRON TRIGGER (20:30)                         │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  1. МОЯ РЕФЛЕКСИЯ                                               │
│     - Что было хорошо в моей работе?                            │
│     - Что было плохо?                                           │
│     - Что буду делать иначе завтра?                             │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. РЕФЛЕКСИЯ С ПОЛЬЗОВАТЕЛЕМ                                   │
│     - Задаю 3 вопроса                                           │
│     - Записываю ответы                                          │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. СОХРАНЕНИЕ В ПАМЯТЬ                                         │
│     - memory/YYYY-MM-DD.md                                      │
│     - data/reflections.json                                     │
└─────────────────────────────────────────────────────────────────┘
```

### Еженедельная аналитика (воскресенье)
- Анализ трендов недели
- Статистика по темам
- Выводы и планы улучшения
- Отчёт пользователю

### Файлы системы
| Файл | Назначение |
|------|------------|
| `reflection-system.md` | Описание системы |
| `REFLECTION-TASKS.md` | Текущие задачи |
| `data/reflections.json` | История рефлексий |

---

## 💓 Heartbeat (фоновые проверки)

### Интервал
- **Каждые 30 минут** (настраивается)
- **Active hours:** 08:00-24:00 (по умолчанию)

### Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│                    HEARTBEAT TRIGGER (каждые 30 мин)            │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  1. ЧИТАЮ HEARTBEAT.md                                          │
│     - Чеклист задач                                             │
│     - Напоминания                                               │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. ПРОВЕРКИ (ротация 2-4 раза в день)                          │
│     - Email (срочные сообщения?)                                │
│     - Календарь (события в ближайшие 24ч?)                      │
│     - Проекты (git status)                                      │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. РЕШЕНИЕ                                                     │
│     - Есть что сообщить? → Отправить сообщение                  │
│     - Ничего важного? → HEARTBEAT_OK (тихо)                     │
└─────────────────────────────────────────────────────────────────┘
```

### Когда сообщать
- ✅ Важное письмо пришло
- ✅ Событие в календаре через <2ч
- ✅ Что-то интересное нашёл
- ✅ Прошло >8ч с последнего сообщения

### Когда молчать
- ❌ Ночь (23:00-08:00)
- ❌ Пользователь занят
- ❌ Ничего нового с прошлой проверки
- ❌ Проверял <30 минут назад

### Файлы системы
| Файл | Назначение |
|------|------------|
| `HEARTBEAT.md` | Чеклист задач |
| `memory/heartbeat-state.json` | Состояние проверок |

---

## 🔄 Git Sync (`/git`)

### Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│                    TELEGRAM: /git                               │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  1. cd ~/Clowdbot                                               │
│  2. git pull origin main                                        │
│  3. git status --short                                          │
│  4. git add -A                                                  │
│  5. git commit -m "<auto message>"                              │
│  6. git push origin main                                        │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  РЕЗУЛЬТАТ:                                                     │
│  ✅ Pushed to main                                              │
│  📝 Commit: abc123                                              │
│  📁 Файлы: список изменённых                                    │
└─────────────────────────────────────────────────────────────────┘
```

### Синхронизация
```
Telegram → /git → GitHub ← git pull ← Mac/Cursor
```

### Файлы системы
| Файл | Назначение |
|------|------------|
| `~/.openclaw/skills/git-sync/SKILL.md` | Skill команды |
| `~/Clowdbot/` | Репозиторий на сервере |

---

## 🗂️ Очистка файлов Mac

### Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│                    TELEGRAM: "Наведи порядок в загрузках"       │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  1. СОЗДАНИЕ БЭКАПА                                             │
│     ~/.openclaw/cleanup-scripts/start-cleanup.sh downloads      │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. АНАЛИЗ ФАЙЛОВ                                               │
│     - Сканирование ~/Downloads                                  │
│     - Группировка по типам (.dmg, .zip, дубликаты)              │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. ПОДТВЕРЖДЕНИЕ                                               │
│     "Удалить 12 .dmg файлов (3.2 GB)? (да/нет)"                 │
│     → Ждёт ответа пользователя                                  │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  4. ВЫПОЛНЕНИЕ + ЗАВЕРШЕНИЕ                                     │
│     - Удаление файлов                                           │
│     - confirm-cleanup.sh или rollback-cleanup.sh                │
└─────────────────────────────────────────────────────────────────┘
```

### Разрешённые папки
- `~/Downloads`
- `~/Desktop`
- `~/Documents`
- `~/Pictures`

### Файлы системы
| Файл | Назначение |
|------|------------|
| `~/.openclaw/agent-instructions.md` | Правила безопасности |
| `~/.openclaw/cleanup-scripts/` | Скрипты очистки |
| `~/.openclaw/exec-approvals.json` | Allowlist команд |

---

## 📊 Сводка всех cron jobs

| Job | Расписание | Описание |
|-----|------------|----------|
| Утренний дайджест | 02:00 UTC (06:00 Dubai) | Новости |
| Дневной дайджест | 09:00 UTC (13:00 Dubai) | Новости |
| Вечерний дайджест | 14:00 UTC (18:00 Dubai) | Новости |
| Ежедневная рефлексия | 20:30 UTC | Рефлексия + вопросы |
| Еженедельный отчёт | Вс 20:30 UTC | Аналитика недели |
| Утренний план | 06:00 UTC | План из рефлексии |

### Управление cron jobs

```bash
# Список всех jobs
openclaw cron list

# Отключить job
openclaw cron remove <job-id>

# Изменить расписание
openclaw cron update <job-id> --schedule "0 9 * * *"
```

---

*Последнее обновление: 2026-02-07*
